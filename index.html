<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Sync Helper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #f8fafc; font-family: sans-serif; }
        .card { background-color: #1e293b; border-radius: 1rem; padding: 1.5rem; }
        .check-item { display: flex; align-items: flex-start; margin-bottom: 1rem; border-bottom: 1px solid #334155; padding-bottom: 0.5rem; }
        input { background-color: #334155; border: none; border-radius: 0.5rem; padding: 0.6rem; width: 100%; color: white; margin-top: 4px; }
        .loading { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="p-4">
    <div class="max-w-md mx-auto">
        <header class="text-center my-6">
            <h1 class="text-2xl font-bold text-slate-300">ğŸ“ Travel Safety & Sync</h1>
            <p class="text-gray-500 text-xs">Itinerary Buffer & Connection Timer</p>
        </header>

        <div class="card mb-6">
            <div class="space-y-4 mb-4">
                <div>
                    <label class="block text-xs text-gray-400">Departure City (A)</label>
                    <input type="text" id="startLoc" placeholder="ä¾‹å¦‚ï¼šæ–°åº—">
                </div>
                <div>
                    <label class="block text-xs text-gray-400">Destination City (B)</label>
                    <input type="text" id="endLoc" placeholder="ä¾‹å¦‚ï¼šå°æ±è»Šç«™">
                </div>
            </div>
            
            <button id="calcBtn" onclick="autoCalculate()" class="w-full py-2 bg-blue-700 hover:bg-blue-600 rounded-lg text-sm font-bold transition-all mb-4">
                ğŸ” ç²å–è·é›¢ä¸¦ç”Ÿæˆæ¸…å–®
            </button>

            <div class="grid grid-cols-2 gap-4">
                <div class="text-center p-3 bg-slate-800 rounded-lg border border-slate-700">
                    <p class="text-[10px] text-gray-400 uppercase">Distance</p>
                    <span id="displayDist" class="text-lg font-mono font-bold text-emerald-400">0</span>
                    <span class="text-emerald-400 text-sm"> km</span>
                </div>
                <div class="text-center p-3 bg-slate-800 rounded-lg border border-slate-700">
                    <p class="text-[10px] text-gray-400 uppercase">Buffer Time</p>
                    <span id="cooldownTime" class="text-lg font-mono font-bold text-blue-400">0</span>
                    <span class="text-blue-400 text-sm"> min</span>
                </div>
            </div>
        </div>

        <div id="todoList" class="card hidden">
            <h3 class="font-bold mb-4 flex items-center text-blue-300">
                <span class="mr-2">ğŸ“‹</span> è¡Œå‹•æ¨™æº–ä½œæ¥­ç¨‹åº (SOP)
            </h3>
            <div id="steps"></div>
            <button onclick="location.reload()" class="w-full mt-4 py-2 bg-gray-600 rounded-lg text-xs">é‡è¨­æ‰€æœ‰åƒæ•¸</button>
        </div>
    </div>

    <script>
        async function getCoords(city) {
            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`);
            const data = await res.json();
            if (data && data.length > 0) {
                return { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon) };
            }
            throw new Error('æ‰¾ä¸åˆ°åœ°é»');
        }

        function haversine(c1, c2) {
            const R = 6371; // åœ°çƒåŠå¾‘ km
            const dLat = (c2.lat - c1.lat) * Math.PI / 180;
            const dLon = (c2.lon - c1.lon) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(c1.lat * Math.PI / 180) * Math.cos(c2.lat * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
            return 2 * R * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        async function autoCalculate() {
            const btn = document.getElementById('calcBtn');
            const start = document.getElementById('startLoc').value;
            const end = document.getElementById('endLoc').value;
            
            if(!start || !end) return alert('è«‹è¼¸å…¥èµ·é»èˆ‡çµ‚é»');
            
            btn.innerText = "â³ æ­£åœ¨ä¼°ç®—è·é›¢...";
            btn.classList.add('loading');

            try {
                const c1 = await getCoords(start);
                const c2 = await getCoords(end);
                const dist = haversine(c1, c2);
                
                document.getElementById('displayDist').innerText = dist.toFixed(1);
                const cd = calculateCD(dist);
                generateList(start, end, cd);
            } catch (e) {
                alert('æœå°‹å¤±æ•—ï¼Œè«‹å˜—è©¦æ›´ç²¾ç¢ºçš„åœ°å');
            } finally {
                btn.innerText = "ğŸ” ç²å–è·é›¢ä¸¦ç”Ÿæˆæ¸…å–®";
                btn.classList.remove('loading');
            }
        }

        function calculateCD(dist) {
            let cd = 0;
            if (dist < 5) cd = 2;
            else if (dist < 10) cd = 7;
            else if (dist < 25) cd = 11;
            else if (dist < 50) cd = 20;
            else if (dist < 100) cd = 35;
            else if (dist < 250) cd = 60;
            else if (dist < 500) cd = 90;
            else cd = 120;
            document.getElementById('cooldownTime').innerText = cd;
            return cd;
        }

        function generateList(start, end, cd) {
            const stepsDiv = document.getElementById('steps');
            const steps = [
                { t: "å¾¹åº•æ®ºæ‰å¾Œå°", d: "1. å‘ä¸Šæ»‘æ‰ Appã€‚ 2. é€²å…¥ã€ç³»çµ±è¨­å®š > æ‡‰ç”¨ç¨‹å¼ > Pikmin Bloomã€é»æ“Šã€å¼·åˆ¶åœæ­¢ã€ã€‚" },
                { t: "åˆ‡æ–·ç’°å¢ƒé—œè¯", d: "é—œé–‰æ‰‹æ©Ÿ WiFi èˆ‡ GPS ç¸½é–‹é—œï¼Œæ”¹ç”¨è¡Œå‹•æ•¸æ“šã€‚" },
                { t: `å•Ÿå‹•æ¨¡æ“¬å®šä½è‡³ ${end}`, d: "é–‹å•Ÿ Fake GPS è»Ÿé«”ä¸¦é–å®šåº§æ¨™ï¼Œä½†å…ˆã€ä¸è¦ã€é–‹å•ŸéŠæˆ²ã€‚" },
                { t: `å•Ÿå‹•å®‰å…¨å†·å»ï¼š${cd} åˆ†é˜`, d: `è¨­å®šé¬§é˜ã€‚é€™æ®µæœŸé–“åš´ç¦é–‹å•ŸéŠæˆ²ï¼Œç¢ºä¿ä¼ºæœå™¨èªç‚ºä½ åœ¨ç§»å‹•ã€‚` },
                { t: "å®Œæˆä»»å‹™ä¸¦æ’¤é€€", d: "é ˜å–çå‹µå¾Œç«‹å³é—œé–‰éŠæˆ²ï¼Œä¸¦é‡è¤‡ã€å¼·åˆ¶åœæ­¢ã€æ­¥é©Ÿå¾Œå†åˆ‡æ›å›çœŸå¯¦å®šä½ã€‚" }
            ];

            stepsDiv.innerHTML = steps.map(s => `
                <div class="check-item">
                    <input type="checkbox" class="w-5 h-5 mt-1 mr-3 accent-blue-500">
                    <div>
                        <p class="text-sm font-medium text-slate-200">${s.t}</p>
                        <p class="text-[11px] text-gray-500 leading-tight">${s.d}</p>
                    </div>
                </div>
            `).join('');

            document.getElementById('todoList').classList.remove('hidden');
        }
    </script>
</body>
</html>
